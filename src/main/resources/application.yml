server:
  port: 9989

spring:
  application:
    name: heronix-guardian
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher

  # Database Configuration (PostgreSQL default)
  datasource:
    url: jdbc:postgresql://localhost:5432/heronix_guardian
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME:heronix}
    password: ${DB_PASSWORD:heronix_dev}
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 300000
      max-lifetime: 1200000
      connection-timeout: 30000

  # JPA/Hibernate
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true

  # H2 Console (disabled by default, enable with h2 profile)
  h2:
    console:
      enabled: false

  # Flyway Database Migrations
  flyway:
    enabled: true
    locations: classpath:db/migration/postgresql
    baseline-on-migrate: true
    validate-on-migrate: true

  # Jackson JSON
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

# Heronix Guardian Configuration (v2.0.0 - Refactored)
heronix:
  guardian:
    # IMPORTANT: v2.0 uses SIS tokenization instead of local tokens
    # Set to true to use existing StudentTokenizationService
    use-sis-tokenization: true

    # Gateway Integration (v2.0)
    gateway:
      enabled: true
      # Require vendors to be registered as SIS gateway devices
      require-device-registration: true

    # Token Configuration (deprecated in v2.0 - uses SIS)
    token:
      expiration-days: 365
      rotation-enabled: true
      rotation-month: 8
      hash-charset: "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"
      hash-length: 8
      checksum-length: 2

    # Encryption (use environment variable in production)
    encryption:
      master-key: ${GUARDIAN_MASTER_KEY:}
      algorithm: AES/GCM/NoPadding
      key-size: 256

    # SIS Integration (REQUIRED for v2.0)
    sis:
      api-url: ${SIS_API_URL:http://localhost:9590}
      api-key: ${SIS_SERVICE_API_KEY:}
      connection-timeout: 10
      read-timeout: 30
      # When true, Guardian acts as a library within SIS (recommended)
      embedded-mode: true

    # Canvas LMS
    canvas:
      timeout-seconds: 30
      retry-attempts: 3
      retry-delay-ms: 1000
      enabled: true

    # Google Classroom
    google:
      timeout-seconds: 30
      retry-attempts: 3
      retry-delay-ms: 1000
      enabled: true

    # Sync Configuration
    sync:
      batch-size: 100
      parallel-threads: 4
      scheduled-enabled: false
      schedule-cron: "0 0 2 * * ?"

    # Audit Configuration
    audit:
      retention-days: 365
      detailed-logging: true

    # Parent Portal Gateway
    parent-portal:
      enabled: true
      require-device-registration: true
      max-requests-per-minute: 60

# Actuator Endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

# Logging
logging:
  level:
    com.heronix.guardian: DEBUG
    org.springframework.security: INFO
    org.hibernate.SQL: WARN

# OpenAPI/Swagger
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    try-it-out-enabled: true
